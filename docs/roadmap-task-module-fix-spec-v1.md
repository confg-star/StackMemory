# StackMemory 学习路线 & 今日任务 修复规格（老板已确认版）

- 版本：v1.1
- 日期：2026-02-23
- 状态：已确认可开发
- 决策（老板拍板）：A, A, A
  - 默认选中策略：A = 最近使用
  - 今日任务日期范围：A = 无限
  - 路线任务跳转目标：A = 跳到今日任务并高亮任务

---

## 1) 项目背景

当前线上为 StackMemory Web（Next.js）项目，核心问题集中在 `/roadmap` 与 `今日任务` 模块：

1. 学习路线下拉框默认有大量假数据（未创建时也有）
2. 创建路线后不显示/显示不稳定
3. 切换路线后数据混杂（两个路线任务混在一起）
4. 今日任务无法左右查看昨日/下一日
5. 学习路线点击某一天任务不能跳转到今日任务对应日期
6. 点击“新建路线”时 UI 会垮掉（弹层/布局/状态异常）
7. 缺少必要交互反馈与小 bug 修复

---

## 2) 目标（本迭代必须达成）

### 2.1 核心功能修复

1. **路线下拉只显示真实数据**
   - 未创建任何路线时：下拉为空 + 空态引导
   - 创建后：下拉出现该路线

2. **创建后可见且稳定**
   - 创建成功后自动刷新列表
   - 自动切换到新路线
   - 页面刷新后仍保持正确显示

3. **路线切换严格隔离**
   - 所有路线视图按 `routeId` 查询与渲染
   - 禁止不同路线数据混合

4. **今日任务增加日期导航**
   - 左右箭头切换前一天/后一天
   - 日期范围无限制

5. **路线任务与今日任务联动**
   - 在学习路线点击某天任务：跳转到今日任务页面
   - 自动定位到对应日期
   - 自动高亮对应任务

6. **新建路线 UI 稳定性修复**
   - 不得再出现界面垮塌/错位/遮罩异常

### 2.2 体验优化

- 增加 loading / empty / error / success 反馈
- 关键交互加入过渡动画与防重复点击
- 清理可见小 bug（不引入回归）

---

## 3) 实施要求（必须遵守）

1. 先审查并定位根因，再修改
2. 优先做原子级改动，不大面积重写
3. 每一组改动都要做验证（至少包含）
   - 创建路线流程
   - 路线切换隔离
   - 今日任务左右切日
   - 路线任务跳转并高亮
   - 新建路线弹窗稳定性
4. 最终输出：
   - 修改文件清单
   - 关键实现说明
   - 验证步骤与结果
   - 残余风险（若有）

---

## 4) 建议技术落点（供实现参考）

- 状态主键：`routeId + date`
- API 查询必须带 routeId（避免混线）
- 任务跳转建议参数：`/tasks?routeId=<id>&date=YYYY-MM-DD&taskId=<id>`
- 在 tasks 页读取参数后执行：
  - 切日期
  - 过滤当前路线
  - 滚动并高亮 task

---

## 5) 验收标准（Done）

1. 新用户无路线时看到空态，无假数据
2. 创建路线后立即可见，可被选中
3. 两条路线互切不混线
4. 今日任务支持左右切昨天/明天（无限）
5. 路线点击任务可跳转并高亮
6. 新建路线不再导致 UI 崩溃
7. 交互体验明显改善

---

## 6) 相关入口

- 目标页面：`/roadmap`、`/tasks`
- 项目目录：`/root/.openclaw/workspace/StackMemory`

> 注意：以本文件为唯一需求基线执行。